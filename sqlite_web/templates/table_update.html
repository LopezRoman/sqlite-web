{% extends "base_table.html" %}

{% block extra_scripts %}
  <script type="text/javascript">
    $(function() {
      $('input.chk-enable-column').on('click', function (evt) {
        var elem = $(this),
            inp = $('#' + elem.data('target-element'));
        if (elem.is(':checked')) {
          inp.prop('disabled', false);
        } else {
          inp.prop('disabled', true);
        }
      });
    });
  </script>
{% endblock %}

{% block inner_content %}
  <h3>Update row in {{ table }}</h3>
  <form action="{{ url_for('table_update', table=table, pk=pk) }}" method="post" role="form">
    {% for column in columns %}
      <div class="form-group row">
        <label for="id_{{ column.name }}" class="col-sm-2 col-form-label">{{ column.name }}</label>
        <div class="col-sm-10">
          <div class="input-group">
            <div class="input-group-prepend">
              <div class="input-group-text">
                <input {% if column.name in edited %}checked {% endif %}class="chk-enable-column" data-target-element="id_{{ column.name }}" type="checkbox" name="chk_{{ column.name }}" aria-label="Allow updating this column.">
              </div>
            </div>
            {% if column.data_type.lower() in ('text', 'blob') %}
              <textarea class="form-control{% if column.name in errors %} is-invalid{% endif %}" {% if column.name not in edited %}disabled {% endif %} id="id_{{ column.name }}" name="{{ column.name }}">{% if row[column.name] == None %}NULL{% else %}{{ row[column.name] }}{% endif %}</textarea>
            {% else %}
              <input class="form-control{% if column.name in errors %} is-invalid{% endif %}" {% if column.name not in edited %}disabled {% endif %} id="id_{{ column.name }}" name="{{ column.name }}" value="{% if row[column.name] == None %}NULL{% else %}{{ row[column.name] }}{% endif %}" />
            {% endif %}
            {% if column.name in errors %}
              <div class="invalid-feedback">{{ errors[column.name] }}</div>
            {% endif %}
          </div>
          {% if column.primary_key %}
            <small class="form-text text-muted">This column is a primary key.</small>
          {% endif %}
        </div>
      </div>
    {% endfor %}
    <button class="btn btn-primary" type="submit">Update</button>
    <a class="btn btn-secondary" href="{{ url_for('table_content', table=table) }}">Cancel</a>
  </form>
{% endblock %}
